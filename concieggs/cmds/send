#!/bin/sh
#
# Udf√∏r en kommando og send resultatet via elektropost til den givne
# adresse.

set -f

eval "$(echo "$@" | parse '(?<rawcmd>.+)( til (?<addr>.+@.+|twitter|spiltirsdag))')"

if [ "$rawcmd" ]; then
    cmd=$(echo "$rawcmd" | cut -d' ' -f 1)
    args=$(echo "$rawcmd"| sed 's/[^ ]* *//')
    if [ $args ]; then
        args=" $args"
    fi

    if [ "$addr" = "spiltirsdag" ]; then
        addr="concieggs@spiltirsdag.dk"
    fi

    result=$(runcmd "$cmd" $args)
    if [ "$addr" = "twitter" ]; then
        runcmd kvidr "$result"
    else
        echo Sender $cmd$args til $addr!

        echo $result | mailx -s "Afvikling af $cmd$args, anmodet af $EGGS_USER" "$addr" -- -r concieggs@eggsml.dk
    fi
else
    echo 'Brug: send <kommando> til <hvem@hvor>'
fi
