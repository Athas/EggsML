#!/bin/sh
#
# Levér fantastisk Apina-link med en snedig og ustyrligt komisk
# kommentar!

kommentar=$(cat $CONCIEGGS_DB_DIR/fakta | sed 's/[.:!?].*//' | fgrep "$1" | grep -v http | sort -R | head -n 1)

linkid() {
    if [ $1 -ne 0 ]; then
        id=$(random 10000 80000)
        if wget --load-cookies $CONCIEGGS_DB_DIR/concieggs_cookies.txt -O /dev/stdout --quiet http://apina.biz/$id | grep 'Entry not found' > /dev/null; then
            linkid $(($id-1))
        else
            echo $id
        fi
    fi
}

id=$(linkid 10)

if [ "$id" ]; then
    echo $kommentar: http://apina.biz/$id
else
    echo "Næh, ingen Apina til dig."
fi
