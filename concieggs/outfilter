#!/bin/sh
#
# This script is run on all non-command output from the IRC bot.

set -e

channel=$1
destuser=$2 # empty if it's not a 'user: message' message.

translate_example() {
    # Example.
    while read -r line; do
        echo "$line" | translate da ja da
    done
}

apply_db_filter() {
    while read -r line; do
        cmd=''
        if [ $destuser ]; then
            cmd=$(dbRead outfilter_command_$destuser || echo -n '')
        fi
        if [ ! "$cmd" ]; then
            cmd=$(dbRead outfilter_command || echo -n '')
        fi
        if [ ! "$cmd" ]; then
            echo "$line"
            continue
        fi
        echo "$line" | $cmd
    done
}

apply_db_filter

# translate_example

# cat
