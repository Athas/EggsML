#!/bin/sh

cd $CONCIEGGS_IRC_DIR

user=$1

echoToServer ":WHOIS $user"
for i in $(seq 1 2); do
    authed=$(tail -n 20 "$CONCIEGGS_IRC_DIR/out" | perl -ne 'if ((($user, $auth) = $_ =~ /\(\S+ (\S+) (\S+)\): is logged in as/) && $user eq $ENV{"user"}) { print $auth; exit(0) }'
    if [ "$authed" ]; then
        echo $authed
        exit
    fi
    sleep 1
done
