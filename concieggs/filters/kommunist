#!/usr/bin/env perl
use 5.012;
use strict;
use warnings;
use utf8::all;
use Env qw(EGGS_USER);
use feature qw(switch say);

sub randpick {
    return $_[rand(@_)];
}

sub enhance {
    my $word = shift;
    return "\cC04☭" . uc $word . "☭\cC";
}

my %aliases = map { (lc($_) => 1) } split("\n", `allAliases`);

my @titles = ('kapi-', 'kammerat ', 'bolsjevik ');
my @suffixes = (qw(ski ev ov sky));

sub commify {
    my $word = shift;
    my $is_name = $aliases{lc $word};

    my $title = $is_name ? randpick(@titles) : '';
    my $suffix = $is_name ? randpick(@suffixes) : '';
    $result = $title . $word . $suffix;

    if ($is_name || rand() < 0.20) {
        $result = enhance($result);
    } elsif (rand() < 0.05) {
        $result = "█" x length $word;
    }

    return $result;
}

while (my $line = <STDIN>) {
    chomp $line;

    my $me = $line =~ m!^/me !i;
    $line = substr $line, 4 if $me;

    $line =~ s/\b(\S+)\b/commify($1)/ge;

    my $meprefix = $me ? "/me " : "";
    say $meprefix . $line;
}
